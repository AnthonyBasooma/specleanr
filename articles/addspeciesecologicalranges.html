<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Flag outliers based on species ecological ranges. • specleanr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Flag outliers based on species ecological ranges.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">specleanr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/addspeciesecologicalranges.html">Flag outliers based on species ecological ranges.</a></li>
    <li><a class="dropdown-item" href="../articles/eOutlier.html">Environmental outlier detection with bootstrapping and principal component analysis.</a></li>
    <li><a class="dropdown-item" href="../articles/generaloutlier.html">General outlier detection for univariate datasets</a></li>
    <li><a class="dropdown-item" href="../articles/Plants.html">Detecting environmental outliers in species distribution models for plants.</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AnthonyBasooma/specleanr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Flag outliers based on species ecological ranges.</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AnthonyBasooma/specleanr/blob/master/vignettes/addspeciesecologicalranges.Rmd" class="external-link"><code>vignettes/addspeciesecologicalranges.Rmd</code></a></small>
      <div class="d-none name"><code>addspeciesecologicalranges.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://anthonybasooma.github.io/specleanr/">specleanr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="introduction-to-outlier-detection-based-on-species-ecological-ranges-">Introduction to outlier detection based on species ecological
ranges.<a class="anchor" aria-label="anchor" href="#introduction-to-outlier-detection-based-on-species-ecological-ranges-"></a>
</h3>
<ul>
<li><p>Species ecological ranges provide the ecological limits within
which the species can survive or reproduce within the ecosystem. These
ranges are usually obtained from experimental setups or continued data
collection. However, the species’ ecological ranges may vary due to
colonization of new ranges. Therefore, if the species ecological ranges
are available, then records obtained outside the ranges can be flagged
as outliers that require further analysis.</p></li>
<li><p>The sources of species ecological ranges include standard
databases such as FishBase <em>(Froese and Pauly 2014)</em>,
www.freshwaterecological.info <em>(Schmidt-Kloiber and Hering
2015)</em>, or the International Union for Conservation of Nature.
Linking to these databases is not outside the scope of this package.
Still, a user can collate a table of species’ ecological ranges and use
it in this package’s <strong><code>multidetect</code></strong> function
to flag outliers.</p></li>
<li><p>This method of using species ecological ranges is concertedly
used with the other outlier detection methods, including univariate and
multivariate methods, as shown below.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="example-using-species-ecological-ranges-with-other-outlier-detection-methods-">Example using species ecological ranges with other outlier detection
methods.<a class="anchor" aria-label="anchor" href="#example-using-species-ecological-ranges-with-other-outlier-detection-methods-"></a>
</h3>
<p><strong>1 Loading example datasets</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"jdsdata"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"efidata"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wcd</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/worldclim.tiff'</span>, package <span class="op">=</span> <span class="st">"specleanr"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#match and clean</span></span>
<span></span>
<span><span class="va">matchd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_datasets.html">match_datasets</a></span><span class="op">(</span>datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>jds<span class="op">=</span> <span class="va">jdsdata</span>, efi <span class="op">=</span><span class="va">efidata</span><span class="op">)</span>,</span>
<span>                         lats <span class="op">=</span> <span class="st">'lat'</span>, lons <span class="op">=</span> <span class="st">'lon'</span>,</span>
<span>                         country <span class="op">=</span> <span class="st">'JDS4_site_ID'</span>,</span>
<span>                         species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'scientificName'</span>, <span class="st">'speciesname'</span><span class="op">)</span>,</span>
<span>                         date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sampling_date'</span>,<span class="st">'Date'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#matchclean &lt;- check_names(matchd, colsp = 'species', verbose = F, merge = T)</span></span>
<span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/danube.shp.zip'</span>,</span>
<span>                              package <span class="op">=</span> <span class="st">"specleanr"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>2. Extracting environmental predictors from worldclim
dataset</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">refdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_extract.html">pred_extract</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">matchd</span>, raster <span class="op">=</span> <span class="va">wcd</span>,</span>
<span>                        lat <span class="op">=</span> <span class="st">'decimalLatitude'</span>,</span>
<span>                        lon <span class="op">=</span> <span class="st">'decimalLongitude'</span>,</span>
<span>                        bbox <span class="op">=</span> <span class="va">db</span>,</span>
<span>                        colsp <span class="op">=</span> <span class="st">'species'</span>,</span>
<span>                        list <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        verbose <span class="op">=</span> <span class="cn">F</span>,</span>
<span>                        minpts <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                        merge <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><strong>3. Preparing ecological ranges for Squalius
cephalus</strong></p>
<p><strong>NOTE</strong></p>
<ul>
<li>The species ecological ranges are made for explanatory purposes, but
do not reflect the species ecological ranges.</li>
<li>
<code>optdata</code> includes five columns, including <strong>1)
species</strong>, which indicates the species names being studied. The
names should be the same as those in the reference dataset. <strong>2)
mintemp</strong> is the minimum temperature of the species (lower
ecological limit). <strong>3) maxtemp</strong> is the species’ maximum
temperature (upper ecological limit). <strong>4) meantemp</strong> is
the species mean temperature, and <strong>5) direction</strong>, which
signifies whether it is greater or lower than in the case of the mean
temperature.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sqcep</span> <span class="op">&lt;-</span> <span class="va">refdata</span><span class="op">[</span><span class="st">"Squalius cephalus"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">optdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Squalius cephalus"</span>, <span class="st">"Abramis brama"</span><span class="op">)</span>,</span>
<span>                      mintemp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">1.6</span><span class="op">)</span>,maxtemp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8.588</span>, <span class="fl">21</span><span class="op">)</span>,</span>
<span>                      meantemp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8.5</span>, <span class="fl">10.4</span><span class="op">)</span>, <span class="co">#ecoparam</span></span>
<span>                      direction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'greater'</span>, <span class="st">'greater'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>4. Outlier detection with univariate, multivariate and
species ecological ranges</strong></p>
<ul>
<li>The <code>multiple</code> parameter is set to <code>TRUE</code> even
when one species is considered because the data is extracted from
<code>refdata</code> dataset that has multiple species.</li>
<li>The <code>optpar</code> is provided in a list format and since the
<code>mintemp</code> and <code>maxtemp</code> are provided, then the
dirction of whether greater or lower are not required to be set.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">squalius_outlier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multidetect.html">multidetect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sqcep</span>, multiple <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      var <span class="op">=</span> <span class="st">'bio1'</span>,</span>
<span>                      output <span class="op">=</span> <span class="st">'outlier'</span>,</span>
<span>                      exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>,<span class="st">'y'</span><span class="op">)</span>,</span>
<span>                      methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'zscore'</span>, <span class="st">'adjbox'</span>, <span class="st">'optimal'</span>, <span class="st">'kmeans'</span>, <span class="st">"logboxplot"</span>, <span class="st">"hampel"</span><span class="op">)</span>,</span>
<span>                      optpar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>optdf<span class="op">=</span><span class="va">optdata</span>, optspcol <span class="op">=</span> <span class="st">'species'</span>,</span>
<span>                                    mincol <span class="op">=</span> <span class="st">"mintemp"</span>, maxcol <span class="op">=</span> <span class="st">"maxtemp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualise-the-number-of-outliers-detected-by-each-method">Visualise the number of outliers detected by each method<a class="anchor" aria-label="anchor" href="#visualise-the-number-of-outliers-detected-by-each-method"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/ggoutliers.html">ggoutliers</a></span><span class="op">(</span><span class="va">squalius_outlier</span><span class="op">)</span></span></code></pre></div>
<p><img src="addspeciesecologicalranges_files/figure-html/ploting-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="obtaining-quality-controlled-dataset-using-loess-method-or-data-labeling">Obtaining quality controlled dataset using loess method or data
labeling<a class="anchor" aria-label="anchor" href="#obtaining-quality-controlled-dataset-using-loess-method-or-data-labeling"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">squalius_qc_loess</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_clean_data.html">extract_clean_data</a></span><span class="op">(</span>refdata <span class="op">=</span> <span class="va">sqcep</span>, </span>
<span>                                      outliers <span class="op">=</span> <span class="va">squalius_outlier</span>, loess <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#clean dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">squalius_qc_loess</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 19</span></span>
<span></span>
<span><span class="co">#reference data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sqcep</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="va">squalius_qc_labeled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classify_data.html">classify_data</a></span><span class="op">(</span>refdata <span class="op">=</span> <span class="va">sqcep</span>, outliers <span class="op">=</span> <span class="va">squalius_outlier</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualise-labelled-quality-controlled-dataset">Visualise labelled quality controlled dataset<a class="anchor" aria-label="anchor" href="#visualise-labelled-quality-controlled-dataset"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="../reference/ggenvironmentalspace.html">ggenvironmentalspace</a></span><span class="op">(</span><span class="va">squalius_qc_labeled</span>, </span>
<span>                     type <span class="op">=</span> <span class="st">'1D'</span>,</span>
<span>                     ggxangle <span class="op">=</span> <span class="fl">45</span>, </span>
<span>                     scalecolor <span class="op">=</span> <span class="st">'viridis'</span>,</span>
<span>                     xhjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                     legend_position <span class="op">=</span> <span class="st">'blank'</span>,</span>
<span>                     ylab <span class="op">=</span> <span class="st">"Number of records"</span>,</span>
<span>                     xlab <span class="op">=</span> <span class="st">"Outlier labels"</span><span class="op">)</span></span></code></pre></div>
<p><img src="addspeciesecologicalranges_files/figure-html/clean%20data%20extraction%20and%20labelling_multiple-1.png" width="432" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="summary-explanation">Summary explanation<a class="anchor" aria-label="anchor" href="#summary-explanation"></a>
</h3>
<ul>
<li>Outliers were flagged by species optimal ranges and the Hampel
method; however, these were not flagged in other methods, which meant
that these were not substantially absolute outliers. Consequently, based
on outlier classification, only fair and not outlier ctageories were
observed.</li>
</ul>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Schmidt-Kloiber, A., &amp; Hering, D. (2015). www.
freshwaterecology. info–an online tool that unifies, standardizes and
codifies more than 20,000 European freshwater organisms and their
ecological preferences. Ecological Indicators, 53, 271-282.</li>
<li>Froese. R and Pauly D (2014). FishBase. world wide web electronic
publication. <a href="http://www" class="external-link uri">http://www</a>. fishbase.
org.</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anthony Basooma, Thomas Hein, Astrid Schmidt-Kloiber, Florian Borgwardt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
