<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Optimising the LOESS method used for automatic identification of the outlier thresholds. â€¢ specleanr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimising the LOESS method used for automatic identification of the outlier thresholds.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">specleanr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/addspeciesecologicalranges.html">Flag outliers based on species ecological ranges.</a></li>
    <li><a class="dropdown-item" href="../articles/eOutlier.html">Environmental outlier detection with bootstrapping and principal component analysis.</a></li>
    <li><a class="dropdown-item" href="../articles/generaloutlier.html">General outlier detection for univariate datasets</a></li>
    <li><a class="dropdown-item" href="../articles/loessmethodoptimisation.html">Optimising the LOESS method used for automatic identification of the outlier thresholds.</a></li>
    <li><a class="dropdown-item" href="../articles/Plants.html">Detecting environmental outliers in species distribution models for plants.</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AnthonyBasooma/specleanr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Optimising the LOESS method used for automatic identification of the outlier thresholds.</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AnthonyBasooma/specleanr/blob/master/vignettes/loessmethodoptimisation.Rmd" class="external-link"><code>vignettes/loessmethodoptimisation.Rmd</code></a></small>
      <div class="d-none name"><code>loessmethodoptimisation.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://anthonybasooma.github.io/specleanr/">specleanr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="identifying-the-optimal-threshold-for-identifying-absolute-outliers-using-the-local-regression-method-loess-">Identifying the optimal threshold for identifying absolute outliers
using the local regression method (LOESS).<a class="anchor" aria-label="anchor" href="#identifying-the-optimal-threshold-for-identifying-absolute-outliers-using-the-local-regression-method-loess-"></a>
</h2>
<p>In the <em>speclceanr</em> package, besides using the naive methods
and data classification, we incorporated the local regression method
(LOESS) in setting the optimal threshold to identify the absolute
outliers. LOESS is a non-parametric scatterplot smoothing method that
uses point-wise linear regression to smooth scatter plots <em>(Cleveland
1979; Cleveland and Devlin 1988)</em>. Because it is a non-parametric
method, the relationship between the independent and dependent variables
should not be set beforehand (Jacoby 2000). It can reveal complex data
patterns compared to traditional statistical methods <em>(Jacoby
2000)</em>.</p>
<p>LOESS is less computationally intensive for small datasets, easy to
compute, and highly resistant to outliers <em>(Cleveland 1979)</em>.
Therefore, we use it to predict the optimal threshold after modeling the
relationship between the data points retained at each threshold. The
thresholds for outlier detection range from 0 to 1 (0 means not an
outlier or the record has not been flagged in any of the outlier
detection methods used, and 1 represents a perfect outlier where the
record has been flagged in all the methods). Therefore, at each
threshold, the data points are retained or flagged out. Then, at the
optimal threshold (global or local maximum), the data points retained
are asymptotic, meaning no more records are flagged out. The optimal
threshold is then used to retain the quality-controlled dataset used in
further analysis.</p>
<p><strong>NOTE</strong></p>
<ul>
<li>If errors in the workflow is associated with FishBase, rerun after 2
to 5 minutes.</li>
</ul>
</div>
<div class="section level2">
<h2 id="examples-using-fish-species">Examples using fish species<a class="anchor" aria-label="anchor" href="#examples-using-fish-species"></a>
</h2>
<div class="section level3">
<h3 id="data-processing-species-and-environmental-variables">Data processing: species and environmental variables<a class="anchor" aria-label="anchor" href="#data-processing-species-and-environmental-variables"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">efidata</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">jdsdata</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">danube</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">"danube.shp.zip"</span>,</span>
<span>                                  package <span class="op">=</span> <span class="st">'specleanr'</span><span class="op">)</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_online</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getdata.html">getdata</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Squalius cephalus"</span>, <span class="st">'Salmo trutta'</span>,<span class="st">"Thymallus thymallus"</span><span class="op">)</span>,</span>
<span>                     extent <span class="op">=</span> <span class="va">danube</span>,</span>
<span>                     gbiflim <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                     inatlim <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                     vertlim <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                     verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mergealldfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_datasets.html">match_datasets</a></span><span class="op">(</span>datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>efi<span class="op">=</span> <span class="va">efidata</span>, jds <span class="op">=</span> <span class="va">jdsdata</span>,</span>
<span>                                              onlinedata <span class="op">=</span> <span class="va">df_online</span><span class="op">)</span>,</span>
<span>                              country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'JDS4_sampling_ID'</span><span class="op">)</span>,</span>
<span>                              lats <span class="op">=</span> <span class="st">'lat'</span>, lons <span class="op">=</span> <span class="st">'lon'</span>,</span>
<span>                              species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'speciesname'</span>, <span class="st">'scientificName'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Cleaning data</span></span>
<span></span>
<span><span class="va">cleannames_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_names.html">check_names</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mergealldfs</span>, colsp <span class="op">=</span> <span class="st">'species'</span>, pct <span class="op">=</span> <span class="fl">90</span>,</span>
<span>                             merge <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spfilter</span> <span class="op">&lt;-</span> <span class="va">cleannames_df</span><span class="op">[</span><span class="va">cleannames_df</span><span class="op">$</span><span class="va">speciescheck</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Squalius cephalus"</span>, <span class="st">'Salmo trutta'</span>,</span>
<span>                                     <span class="st">"Thymallus thymallus"</span>,<span class="st">"Anguilla anguilla"</span>, </span>
<span>                                     <span class="st">'Barbatula barbatula'</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">worldclim</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/worldclim.tiff'</span>, package <span class="op">=</span> <span class="st">'specleanr'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Get basin shapefile to delineate the study region: optional</span></span>
<span></span>
<span><span class="va">danube</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'danube.shp.zip'</span>,</span>
<span>                                  package <span class="op">=</span> <span class="st">'specleanr'</span><span class="op">)</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="oultier-detection-threshold-optimisation-using-loess-and-plotting">Oultier detection, threshold optimisation using LOESS and
plotting<a class="anchor" aria-label="anchor" href="#oultier-detection-threshold-optimisation-using-loess-and-plotting"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>, <span class="fl">1.5</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    oma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    mgp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.7</span>, <span class="fl">0.8</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">spp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">spfilter</span><span class="op">$</span><span class="va">speciescheck</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pltout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">spp</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">spout</span> <span class="op">&lt;-</span> <span class="va">spfilter</span><span class="op">[</span><span class="va">spfilter</span><span class="op">[</span>,<span class="st">'speciescheck'</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">s</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">refdata</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/pred_extract.html">pred_extract</a></span><span class="op">(</span>data<span class="op">=</span> <span class="va">spout</span>, raster<span class="op">=</span> <span class="va">worldclim</span>,</span>
<span>                           lat <span class="op">=</span> <span class="st">'decimalLatitude'</span>,</span>
<span>                           lon <span class="op">=</span> <span class="st">'decimalLongitude'</span>,</span>
<span>                           colsp <span class="op">=</span> <span class="st">'speciescheck'</span>,</span>
<span>                           bbox  <span class="op">=</span> <span class="va">danube</span>,</span>
<span>                           list<span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           minpts <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">outdet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multidetect.html">multidetect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">refdata</span>, multiple <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        var <span class="op">=</span> <span class="st">'bio6'</span>, output <span class="op">=</span> <span class="st">'outlier'</span>,</span>
<span>                        exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>,<span class="st">'y'</span><span class="op">)</span>,</span>
<span>                        methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'zscore'</span>, <span class="st">'adjbox'</span>,</span>
<span>                                    <span class="st">'logboxplot'</span>, <span class="st">'distboxplot'</span>,</span>
<span>                                    <span class="st">'iqr'</span>, <span class="st">'semiqr'</span>,<span class="st">'seqfences'</span>,</span>
<span>                                    <span class="st">'hampel'</span>,<span class="st">'kmeans'</span>,</span>
<span>                                    <span class="st">'jknife'</span>, <span class="st">'onesvm'</span>,</span>
<span>                                    <span class="st">'iforest'</span><span class="op">)</span>, </span>
<span>                        warn <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">refdata</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimal_threshold.html">optimal_threshold</a></span><span class="op">(</span>refdata <span class="op">=</span> <span class="va">refdata</span>, outliers <span class="op">=</span> <span class="va">outdet</span>, </span>
<span>                             plotsetting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="cn">TRUE</span>, group <span class="op">=</span> <span class="va">s</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">opt</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 11</span></span>
<span><span class="co">#&gt; [1] 15</span></span>
<span><span class="co">#&gt; [1] 65</span></span>
<span><span class="co">#&gt; [1] 96</span></span>
<span><span class="co">#&gt; [1] 96</span></span></code></pre></div>
<p><img src="loessmethodoptimisation_files/figure-html/outlierdetoptplot-1.png" width="720" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="summary-explanation">Summary explanation<a class="anchor" aria-label="anchor" href="#summary-explanation"></a>
</h3>
<p>To ensure the <strong>LOESS</strong> model was only fitted if a group
or species had absolute outliers, we set a cutoff of
<strong>0.6</strong>. So, LOESS will not be fitted if outliers are not
detected in less than half of the outlier detection methods. For
example, in the figure above, the threshold was only optimized for
<em>Salmo trutta</em>, <em>Anguilla anguilla</em>, and <em>Thymallus
thymallus</em>. In <em>Barbatula barbatula</em> and <em>Squalius
cephalus</em> the outliers with the highest weight was 0.41 and 0.5
respectively.</p>
</div>
<div class="section level3">
<h3 id="simulating-for-small-datasets-less-than-25-records">Simulating for small datasets less than 25 records<a class="anchor" aria-label="anchor" href="#simulating-for-small-datasets-less-than-25-records"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">113554333</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">32</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">6</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#add outlier rows</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">409</span>, <span class="fl">43</span>, <span class="fl">76</span>, <span class="fl">23</span><span class="op">)</span></span>
<span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2409</span>, <span class="fl">10</span>, <span class="fl">43</span>, <span class="fl">22</span><span class="op">)</span></span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1509</span>, <span class="fl">0.43</span>, <span class="fl">76</span>, <span class="fl">23</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span>, <span class="va">d</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">out</span>, <span class="va">out1</span>, <span class="va">out2</span><span class="op">)</span></span></code></pre></div>
<p><strong>Outlier detection for small datasets</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outdet2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multidetect.html">multidetect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df2</span>, multiple <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      var <span class="op">=</span> <span class="st">'a'</span>, output <span class="op">=</span> <span class="st">'outlier'</span>,</span>
<span>                      methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'zscore'</span>, <span class="st">'adjbox'</span>,</span>
<span>                                  <span class="st">'logboxplot'</span>, <span class="st">'distboxplot'</span>,</span>
<span>                                  <span class="st">'iqr'</span>, <span class="st">'semiqr'</span>,<span class="st">'seqfences'</span>,</span>
<span>                                  <span class="st">'hampel'</span>,<span class="st">'kmeans'</span>,</span>
<span>                                  <span class="st">'jknife'</span>, <span class="st">'onesvm'</span>,</span>
<span>                                  <span class="st">'iforest'</span><span class="op">)</span>, </span>
<span>                      warn <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Visualize the threshold</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">opt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimal_threshold.html">optimal_threshold</a></span><span class="op">(</span>refdata <span class="op">=</span> <span class="va">df2</span>, </span>
<span>                          outliers <span class="op">=</span> <span class="va">outdet2</span>, </span>
<span>                         plotsetting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="loessmethodoptimisation_files/figure-html/visualise%20data-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opt1</span></span>
<span><span class="co">#&gt;  localmaxima globalmaxima </span></span>
<span><span class="co">#&gt;    0.3333333    0.7000000</span></span></code></pre></div>
<ul>
<li>In the above scenario, the outlier detection exponentially increased
and therefore absolute outliers were recorded denoted when the
predictions exponentially increased. The optimal threshold of 0.7 will
be automatically determined which filters out the three absolute
outliers introduced in the data.</li>
</ul>
<p><strong>Record weights used quality controlled data
extraction.</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#get the weights for the flagged records</span></span>
<span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ocindex.html">ocindex</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">outdet2</span>, absolute <span class="op">=</span> <span class="cn">TRUE</span>, props <span class="op">=</span> <span class="cn">TRUE</span>, threshold <span class="op">=</span> <span class="fl">0.1</span>, warn <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span><span class="co">#&gt;   absoluteoutliers absolute_propn</span></span>
<span><span class="co">#&gt; 1       1509.00000      0.8333333</span></span>
<span><span class="co">#&gt; 2         -0.24090      0.8333333</span></span>
<span><span class="co">#&gt; 3         29.67535      0.2500000</span></span>
<span><span class="co">#&gt; 4         29.93587      0.1666667</span></span>
<span><span class="co">#&gt; 5         30.21504      0.1666667</span></span>
<span><span class="co">#&gt; 6        409.00000      0.8333333</span></span>
<span></span>
<span><span class="va">dfclean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_clean_data.html">extract_clean_data</a></span><span class="op">(</span>refdata <span class="op">=</span> <span class="va">df2</span>, outliers <span class="op">=</span> <span class="va">outdet2</span>, loess <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dfclean</span><span class="op">)</span></span>
<span><span class="co">#&gt;           a        b           c        d</span></span>
<span><span class="co">#&gt; 1  31.25813 3.737545 -0.82219326 7.503630</span></span>
<span><span class="co">#&gt; 2  31.02957 2.119252  0.13058514 6.440053</span></span>
<span><span class="co">#&gt; 3  33.29139 5.233229  1.18249791 6.088826</span></span>
<span><span class="co">#&gt; 4  31.96807 2.922396  0.82110108 5.327947</span></span>
<span><span class="co">#&gt; 5  32.61594 2.546680 -0.83512143 5.219957</span></span>
<span><span class="co">#&gt; 6  29.67535 4.710109  0.55900929 5.895726</span></span>
<span><span class="co">#&gt; 7  31.76902 3.506267 -0.46201898 6.381637</span></span>
<span><span class="co">#&gt; 8  31.45304 3.843909 -1.65670047 6.140398</span></span>
<span><span class="co">#&gt; 9  32.04668 2.965477  0.64843924 6.047407</span></span>
<span><span class="co">#&gt; 10 32.73326 4.184567 -1.00567760 5.731261</span></span>
<span><span class="co">#&gt; 11 33.21300 5.091759  0.38357100 4.818790</span></span>
<span><span class="co">#&gt; 12 30.21504 3.176954 -1.17762603 5.049447</span></span>
<span><span class="co">#&gt; 13 33.21133 4.047397 -1.35670434 5.635227</span></span>
<span><span class="co">#&gt; 14 32.66286 4.972343  1.44484341 5.595836</span></span>
<span><span class="co">#&gt; 15 31.96946 4.216062  0.53427151 6.666718</span></span>
<span><span class="co">#&gt; 16 31.05610 3.842254 -0.01738607 5.205542</span></span>
<span><span class="co">#&gt; 17 31.71313 3.653900 -0.66187088 6.121317</span></span>
<span><span class="co">#&gt; 18 29.93587 4.788469 -0.45837542 6.988470</span></span>
<span><span class="co">#&gt; 19 31.05060 4.961393 -1.43076151 5.958698</span></span>
<span><span class="co">#&gt; 20 32.97297 3.277845 -0.85659474 6.011441</span></span>
<span><span class="co">#&gt; 21 33.29464 3.245113  2.54273477 7.643912</span></span>
<span><span class="co">#&gt; 22 31.49925 4.432043  0.01498154 5.916007</span></span>
<span><span class="co">#&gt; 23 34.18672 4.237679 -2.22131128 7.192626</span></span>
<span><span class="co">#&gt; 24 31.64430 5.113328  1.21073632 5.014243</span></span>
<span><span class="co">#&gt; 25 32.01278 5.279782 -0.80406361 6.343229</span></span>
<span><span class="co">#&gt; 26 31.44525 5.176739  0.41815878 5.454909</span></span>
<span><span class="co">#&gt; 27 31.50548 3.282632 -0.65628423 6.113609</span></span>
<span><span class="co">#&gt; 28 32.48145 2.885475  0.39630888 5.864295</span></span>
<span><span class="co">#&gt; 29 31.09465 3.842594  1.03801580 6.327794</span></span>
<span><span class="co">#&gt; 30 31.75320 3.720425  1.08670241 4.024865</span></span></code></pre></div>
<p><strong>NOTE</strong></p>
<ul>
<li>The outliers are removed from the dataset from the dataset
automatically using the LOESS method.</li>
<li>The legend is sometimes hidden.</li>
</ul>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Cleveland, W. S. 1979. Robust Locally Weighted Regression and
Smoothing Scatterplots. - J Am Stat Assoc 74</li>
<li>Cleveland, W. S. and Devlin, S. J. 1988. Locally Weighted
Regression: An Approach to Regression Analysis by Local Fitting. - J Am
Stat Assoc 83</li>
<li>Jacoby, W. G. 2000. Electoral inquiry section Loess: a
nonparametric, graphical tool for depicting relationships between
variables. - Elect Stud 19</li>
</ol>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anthony Basooma, Thomas Hein, Astrid Schmidt-Kloiber, Florian Borgwardt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
